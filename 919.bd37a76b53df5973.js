"use strict";(self.webpackChunkdigitechschool_webapp=self.webpackChunkdigitechschool_webapp||[]).push([[919],{9919:(G,g,i)=>{i.r(g),i.d(g,{CaisseModule:()=>z});var m=i(8783),l=i(9450),h=i(2340),e=i(4650),v=i(805),d=i(1135),b=i(529);const u=h.N.backendUrl+"depenses";let f=(()=>{class n{constructor(t){this._httpClient=t,this._depenses=new d.X([]),this._total=new d.X(0)}get depenses$(){return this._depenses.asObservable()}get total$(){return this._total.asObservable()}getDepense(t){return this._httpClient.get(`${u}/${t}`)}getDepensesByMonth(t){this._httpClient.get(`${u}/mois/${t}`).subscribe(s=>{this._depenses.next(s.depenses),this._total.next(s.total)})}addDepense(t){const s=new FormData;return s.append("label",t.label),s.append("montant",`${t.montant}`),t.preuves&&s.append("preuves",t.preuves),this._httpClient.post(`${u}/add`,s)}updateDepense(t){return this._httpClient.put(`${u}/${t._id}`,t)}deleteDepense(t){return this._httpClient.delete(`${u}/${t}`)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(b.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const c=h.N.backendUrl+"encaissements";let S=(()=>{class n{constructor(t){this._httpClient=t,this._encaissements=new d.X([]),this._total=new d.X(0)}get encaissements$(){return this._encaissements.asObservable()}get total$(){return this._total.asObservable()}getEncaissement(t){return this._httpClient.get(`${c}/${t}`)}getEncaissementsByMonth(t){this._httpClient.get(`${c}/mois/${t}`).subscribe(s=>{this._encaissements.next(s.encaissements),this._total.next(s.total)})}updateEncaissement(t){return this._httpClient.put(`${c}/${t._id}`,t)}deleteEncaissement(t){return this._httpClient.delete(`${c}/${t}`)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(b.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var a=i(433),C=i(5593),_=i(4247),U=i(2137),M=i(666),Z=i(1795),F=i(8396),D=i(2453),T=i(1493),L=i(6895);function x(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Libelle"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Montant"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Actions"),e.qZA()())}const $=function(n){return["modifier-depense",n]};function J(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"date"),e.qZA(),e.TgZ(8,"td"),e._UZ(9,"button",16),e.TgZ(10,"button",17),e.NdJ("click",function(){const p=e.CHM(t).$implicit,X=e.oxw();return e.KtG(X.showPreuve(p.preuves))}),e.qZA()()()}if(2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.label),e.xp6(2),e.Oqu(t.montant),e.xp6(2),e.Oqu(e.xi3(7,4,t.date,"dd/MM/yyyy")),e.xp6(3),e.Q6J("routerLink",e.VKq(7,$,t._id))}}function E(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Montant"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Date"),e.qZA()())}function N(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.montant),e.xp6(2),e.Oqu(e.xi3(5,2,t.date,"dd/MM/yyyy"))}}const q=function(){return["nouvelle-depense"]},w=function(){return{width:"50vw"}},B=function(){return{width:"100%"}};let O=(()=>{class n{constructor(t,s,r,p){this._confirmationService=t,this._messageService=s,this._depenseService=r,this._encaissementService=p,this.months=[{name:"Janvier",value:1},{name:"F\xe9vrier",value:2},{name:"Mars",value:3},{name:"Avril",value:4},{name:"Mai",value:5},{name:"Juin",value:6},{name:"Juillet",value:7},{name:"Ao\xfbt",value:8},{name:"Septembre",value:9},{name:"Octobre",value:10},{name:"Novembre",value:11},{name:"D\xe9cembre",value:12}],this.baseUrl=h.N.baseUrl,this.displayPreuve=!1,this.now=new Date,this.depenses=[],this.totalDepense=0,this.encaissements=[],this.totalEncaissement=0}ngOnInit(){this.selectedMonth=this.months[this.now.getMonth()],this._depenseService.depenses$.subscribe(t=>this.depenses=t),this._depenseService.total$.subscribe(t=>this.totalDepense=t),this._encaissementService.encaissements$.subscribe(t=>this.encaissements=t),this._encaissementService.total$.subscribe(t=>this.totalEncaissement=t),this.loadCaisse()}loadCaisse(){this._depenseService.getDepensesByMonth(this.selectedMonth.value),this._encaissementService.getEncaissementsByMonth(this.selectedMonth.value)}showPreuve(t){this.preuveSelected=t,this.displayPreuve=!0}closePreuve(){this.preuveSelected=null,this.displayPreuve=!1}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(v.YP),e.Y36(v.ez),e.Y36(f),e.Y36(S))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-caisse-list"]],decls:33,vars:17,consts:[[1,"w-100","h-100"],[1,"grid"],[1,"col-12","md:col-4"],["optionLabel","name",3,"options","ngModel","onChange","ngModelChange"],[1,"col-12","md:col-4","d-flex","justify-content-end"],["pButton","","pRipple","","type","button","label","Nouvelle d\xe9pense","icon","pi pi-plus",1,"p-button-rounded","p-button-primary","p-button-text",3,"routerLink"],["header","D\xe9penses"],[1,"col-12","d-flex","justify-content-between","align-items-center"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["header","Encaissements"],["rejectButtonStyleClass","p-button-text",3,"baseZIndex"],[3,"visible","onHide","visibleChange"],[1,"w-100"],["alt","",1,"preuve",3,"src"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-rounded","p-button-warning","p-button-text",3,"routerLink"],["pButton","","pRipple","","icon","pi pi-book",1,"p-button-rounded","p-button","p-button-text",3,"click"]],template:function(t,s){1&t&&(e.TgZ(0,"p-card",0)(1,"div",1)(2,"div",2)(3,"h2"),e._uU(4,"Caisse"),e.qZA()(),e.TgZ(5,"div",2)(6,"p-dropdown",3),e.NdJ("onChange",function(){return s.loadCaisse()})("ngModelChange",function(p){return s.selectedMonth=p}),e.qZA()(),e.TgZ(7,"div",4),e._UZ(8,"button",5),e.qZA()(),e.TgZ(9,"p-tabView")(10,"p-tabPanel",6)(11,"div",7)(12,"h4"),e._uU(13,"Total d\xe9pense :"),e.qZA(),e.TgZ(14,"b"),e._uU(15),e.qZA()(),e.TgZ(16,"p-table",8),e.YNc(17,x,9,0,"ng-template",9),e.YNc(18,J,11,9,"ng-template",10),e.qZA()(),e.TgZ(19,"p-tabPanel",11)(20,"div",7)(21,"h4"),e._uU(22,"Total encaissement :"),e.qZA(),e.TgZ(23,"b"),e._uU(24),e.qZA()(),e.TgZ(25,"p-table",8),e.YNc(26,E,5,0,"ng-template",9),e.YNc(27,N,6,5,"ng-template",10),e.qZA()()()(),e._UZ(28,"p-confirmDialog",12)(29,"p-toast"),e.TgZ(30,"p-dialog",13),e.NdJ("onHide",function(){return s.closePreuve})("visibleChange",function(p){return s.displayPreuve=p}),e.TgZ(31,"div",14),e._UZ(32,"img",15),e.qZA()()),2&t&&(e.xp6(6),e.Q6J("options",s.months)("ngModel",s.selectedMonth),e.xp6(2),e.Q6J("routerLink",e.DdM(14,q)),e.xp6(7),e.hij("",s.totalDepense," FCFA"),e.xp6(1),e.Q6J("value",s.depenses),e.xp6(8),e.hij("",s.totalEncaissement," FCFA"),e.xp6(1),e.Q6J("value",s.encaissements),e.xp6(3),e.Akn(e.DdM(15,w)),e.Q6J("baseZIndex",1e4),e.xp6(2),e.Akn(e.DdM(16,B)),e.Q6J("visible",s.displayPreuve),e.xp6(2),e.Q6J("src",s.baseUrl+s.preuveSelected,e.LSH))},dependencies:[a.JJ,a.On,C.Hq,_.Z,v.jx,U.Q,M.Lt,l.rH,Z.H,F.iA,D.FN,T.V,m.xf,m.x4,L.uU],styles:[".preuve[_ngcontent-%COMP%]{width:100%;object-fit:contain}"]}),n})(),I=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-caisse"]],decls:1,vars:0,template:function(t,s){1&t&&e._UZ(0,"router-outlet")},dependencies:[l.lC]}),n})();var Y=i(5047),P=i(1740),y=i(7254);const j=function(){return["/etablissement/caisses"]};let A=(()=>{class n{constructor(t,s,r){this._route=t,this._router=s,this._depenseService=r,this.depenseForm=new a.cw({label:new a.NI("",[a.kI.required]),montant:new a.NI("",[a.kI.required,a.kI.min(500)])}),this.preuves=null,this.isEdit=!1,this.title="Nouvelle d\xe9pense"}ngOnInit(){this._route.params.subscribe(t=>{t.id&&this._depenseService.getDepense(t.id).subscribe(s=>{this.depense=s,this.title="Modifier d\xe9pense",this.isEdit=!0,this.depenseForm.patchValue(s)})})}onUpload(t){this.preuves=t.currentFiles[0]}clear(){this.preuves=null}onSubmit(){this.depenseForm.invalid||(this.depense={...this.depense,...this.depenseForm.value,preuves:this.preuves},this.isEdit?this._depenseService.updateDepense(this.depense).subscribe({next:()=>{this._router.navigate(["/etablissement/caisses"])}}):this._depenseService.addDepense(this.depense).subscribe({next:()=>{this._router.navigate(["/etablissement/caisses"])}}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.gz),e.Y36(l.F0),e.Y36(f))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-depense-form"]],decls:20,vars:7,consts:[[1,"d-flex","justify-content-between","align-items-center"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded","p-button-secondary","p-button-text",3,"routerLink"],[3,"formGroup","ngSubmit"],[1,"grid"],[1,"field","col-12","md:col-6"],["for","label"],["pInputText","","inputId","label","formControlName","label",1,"form-control"],["for","montant"],["inputId","montant","formControlName","montant",1,"form-control"],[1,"field","col-12"],["name","preuve","chooseLabel","Preuve","cancelLabel","Annuler","chooseStyleClass","bg-secondary","uploadStyleClass","hidden","accept","image/*",3,"maxFileSize","onClear","onRemove","onSelect"],["pButton","","type","submit",1,"p-button","p-button-lg",3,"disabled"]],template:function(t,s){1&t&&(e.TgZ(0,"p-card")(1,"div",0)(2,"h2"),e._uU(3),e.qZA(),e._UZ(4,"button",1),e.qZA(),e.TgZ(5,"form",2),e.NdJ("ngSubmit",function(){return s.onSubmit()}),e.TgZ(6,"div",3)(7,"div",4)(8,"label",5),e._uU(9,"Libelle"),e.qZA(),e._UZ(10,"input",6),e.qZA(),e.TgZ(11,"div",4)(12,"label",7),e._uU(13,"montant"),e.qZA(),e._UZ(14,"p-inputNumber",8),e.qZA(),e.TgZ(15,"div",9)(16,"p-fileUpload",10),e.NdJ("onClear",function(){return s.clear()})("onRemove",function(){return s.clear()})("onSelect",function(p){return s.onUpload(p)}),e.qZA()(),e.TgZ(17,"div",9)(18,"button",11),e._uU(19),e.qZA()()()()()),2&t&&(e.xp6(3),e.Oqu(s.title),e.xp6(1),e.Q6J("routerLink",e.DdM(6,j)),e.xp6(1),e.Q6J("formGroup",s.depenseForm),e.xp6(11),e.Q6J("maxFileSize",1e6),e.xp6(2),e.Q6J("disabled",s.depenseForm.invalid),e.xp6(1),e.hij(" ",s.isEdit?"Modifier":"Enregistrer"," "))},dependencies:[a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,C.Hq,_.Z,Y.Rn,P.o,l.rH,Z.H,y.p]}),n})();const Q=[{path:"",component:I,children:[{path:"",component:O},{path:"nouvelle-depense",component:A},{path:"modifier-depense/:id",component:A}]}];let R=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[l.Bz.forChild(Q),l.Bz]}),n})();var H=i(296);let z=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[H.m,T.S,y.O,m.LU,R]}),n})()}}]);